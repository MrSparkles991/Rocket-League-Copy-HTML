<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Último Turno</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
* { margin:0; padding:0; box-sizing:border-box; font-family: monospace; }
body { background:#000; overflow:hidden; color:#fff; }

/* ===== JOGO ===== */
#game {
    position: relative;
    width: 100vw;
    height: 100vh;
    background:#000;
}

/* ===== MAPA ===== */
#map {
    position:absolute;
    width:2000px;
    height:2000px;
    background:
        repeating-linear-gradient(90deg,#2a2a2a 0,#2a2a2a 80px,#1f1f1f 80px,#1f1f1f 160px),
        repeating-linear-gradient(0deg,#333 0,#333 80px,#262626 80px,#262626 160px);
}

/* ===== PRATELEIRAS ===== */
.shelf {
    position:absolute;
    width:280px;
    height:60px;
    background:#111;
    border:2px solid #555;
}

/* ===== PLAYER ===== */
#player {
    position:absolute;
    width:32px;
    height:32px;
    background:#fff;
    border-radius:4px;
    box-shadow:0 0 15px rgba(255,255,255,0.5);
}

/* ===== ENTIDADE ===== */
#entity {
    position:absolute;
    width:40px;
    height:40px;
    background:rgba(255,0,0,0.35);
    border-radius:50%;
    filter:blur(6px);
    display:none;
}

/* ===== ESCURIDÃO ===== */
#darkness {
    position:absolute;
    inset:0;
    pointer-events:none;
    background:radial-gradient(circle at center, transparent 130px, rgba(0,0,0,0.95) 320px);
}

/* ===== TEXTO ===== */
#message {
    position:fixed;
    bottom:15px;
    width:100%;
    text-align:center;
    opacity:0.85;
}

/* ===== JOYSTICK ===== */
#joystick {
    position:fixed;
    left:20px;
    bottom:20px;
    width:120px;
    height:120px;
    border-radius:50%;
    background:rgba(255,255,255,0.1);
    touch-action:none;
}

#stick {
    position:absolute;
    left:40px;
    top:40px;
    width:40px;
    height:40px;
    border-radius:50%;
    background:rgba(255,255,255,0.6);
}

/* ===== BOTÃO E ===== */
#btnE {
    position:fixed;
    right:30px;
    bottom:50px;
    width:70px;
    height:70px;
    border-radius:50%;
    background:rgba(255,255,255,0.15);
    border:2px solid #999;
    color:#fff;
    font-size:22px;
}
</style>
</head>

<body>

<div id="game">
    <div id="map"></div>
    <div id="player"></div>
    <div id="entity"></div>
    <div id="darkness"></div>
</div>

<div id="message">Último turno… algo está errado.</div>

<div id="joystick"><div id="stick"></div></div>
<button id="btnE">E</button>

<script>
/* ===== ELEMENTOS ===== */
const player = document.getElementById("player");
const map = document.getElementById("map");
const entity = document.getElementById("entity");
const message = document.getElementById("message");

/* ===== PLAYER ===== */
let px = 1000, py = 1000;
let sanity = 100;

/* ===== PRATELEIRAS ===== */
for(let i=0;i<12;i++){
    let s=document.createElement("div");
    s.className="shelf";
    s.style.left=Math.random()*1700+"px";
    s.style.top=Math.random()*1700+"px";
    map.appendChild(s);
}

/* ===== TECLADO ===== */
const keys = {};
addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

/* ===== JOYSTICK ===== */
const joystick = document.getElementById("joystick");
const stick = document.getElementById("stick");
let joyX=0, joyY=0, dragging=false;

joystick.addEventListener("touchstart",e=>dragging=true);
joystick.addEventListener("touchend",()=>{
    dragging=false; joyX=joyY=0;
    stick.style.left="40px"; stick.style.top="40px";
});
joystick.addEventListener("touchmove",e=>{
    if(!dragging) return;
    let r=joystick.getBoundingClientRect();
    let x=e.touches[0].clientX-r.left-60;
    let y=e.touches[0].clientY-r.top-60;
    let d=Math.hypot(x,y);
    if(d>40){ x*=40/d; y*=40/d; }
    joyX=x/40; joyY=y/40;
    stick.style.left=x+60-20+"px";
    stick.style.top=y+60-20+"px";
});

/* ===== INTERAÇÃO ===== */
document.getElementById("btnE").onclick=()=>interact();
addEventListener("keydown",e=>{ if(e.key.toLowerCase()=="e") interact(); });

function interact(){
    sanity-=5;
    message.innerText="Você sente que está sendo observado…";
}

/* ===== LOOP ===== */
function update(){
    let speed=2.5;
    if(keys["w"]) py-=speed;
    if(keys["s"]) py+=speed;
    if(keys["a"]) px-=speed;
    if(keys["d"]) px+=speed;

    px+=joyX*speed*1.5;
    py+=joyY*speed*1.5;

    player.style.left=px+"px";
    player.style.top=py+"px";
    map.style.transform=`translate(${-px+innerWidth/2}px,${-py+innerHeight/2}px)`;

    /* ENTIDADE */
    if(Math.random()<0.003){
        entity.style.display="block";
        entity.style.left=px+(Math.random()*400-200)+"px";
        entity.style.top=py+(Math.random()*400-200)+"px";
        sanity-=10;
        setTimeout(()=>entity.style.display="none",500);
    }

    if(sanity<=0){
        message.innerText="Você nunca saiu do supermercado.";
    }

    requestAnimationFrame(update);
}
update();
</script>

</body>
</html>
