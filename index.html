<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Behavior Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #000;
}

#world {
  width: 100vw;
  height: 100vh;
  position: relative;
  perspective: 800px;
}

#player {
  width: 40px;
  height: 40px;
  background: white;
  position: absolute;
  left: 50%;
  top: 50%;
  transform-style: preserve-3d;
}

#camera {
  position: absolute;
  width: 100%;
  height: 100%;
  pointer-events: none;
}
</style>
</head>

<body>

<div id="world">
  <div id="camera">
    <div id="player"></div>
  </div>
</div>

<script>
/* ===============================
   INPUT SYSTEM
================================ */
const Input = {
  keys: {},
  mouseX: 0,
  mouseY: 0
};

window.addEventListener("keydown", e => Input.keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => Input.keys[e.key.toLowerCase()] = false);

document.body.addEventListener("click", () => {
  document.body.requestPointerLock();
});

document.addEventListener("mousemove", e => {
  Input.mouseX = e.movementX;
  Input.mouseY = e.movementY;
});

/* ===============================
   ENGINE CORE
================================ */
const ENGINE = {
  player: document.getElementById("player"),
  x: window.innerWidth / 2,
  y: window.innerHeight / 2,
  rotX: 0,
  rotY: 0,
  speed: 4,
  sensitivity: 0.15,

  update() {
    if (Input.keys["w"]) this.y -= this.speed;
    if (Input.keys["s"]) this.y += this.speed;
    if (Input.keys["a"]) this.x -= this.speed;
    if (Input.keys["d"]) this.x += this.speed;

    this.rotY += Input.mouseX * this.sensitivity;
    this.rotX -= Input.mouseY * this.sensitivity;
    this.rotX = Math.max(-90, Math.min(90, this.rotX));

    this.player.style.left = this.x + "px";
    this.player.style.top = this.y + "px";
    this.player.style.transform =
      `rotateX(${this.rotX}deg) rotateY(${this.rotY}deg)`;

    Input.mouseX = 0;
    Input.mouseY = 0;

    requestAnimationFrame(this.update.bind(this));
  }
};

/* ===============================
   BEHAVIOR PARSER
================================ */
function runBehavior(code) {

  if (code.includes('<create>("Object")')) {
    console.log("Behavior: Object criado");
  }

  if (code.includes('<Nickname.object>("Player")')) {
    console.log("Behavior: Player definido");
  }

  if (code.includes('Comands.Player')) {
    console.log("Behavior: Comandos do player ativados");
  }

  ENGINE.update();
}

/* ===============================
   BEHAVIOR SCRIPT (GAME)
================================ */
const behaviorScript = `
<Behavior.main>
<head--main>
  <create>("Object")
  <Nickname.object>("Player")
</head--main>

<Body>
  <Select>("Player_Object")
  <create>("Comands.Player")
</Body>

<script>
Function use: ("Comands.Player") for </W>, </A>, </S>, </D>;
<verifyThis> = Real
</script>
</Behavior.main>
`;

runBehavior(behaviorScript);
</script>

</body>
</html>
